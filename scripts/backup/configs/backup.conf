# ============================================================
# PostgreSQL Backup Configuration
# ============================================================
# This file contains all configuration for the backup system
# Make sure to set appropriate permissions: chmod 600 backup.conf
# ============================================================

# ============================================================
# DATABASE CONFIGURATION
# ============================================================
# PostgreSQL connection details from .env
DB_HOST="46.224.33.191"
DB_PORT="5432"
DB_NAME="copilot_dev"
DB_USER="copilot_dev"
DB_PASSWORD="0tF8ex0EYYLKJ8%2B4gZqP%2FHiqsCEfRfJt"

# ============================================================
# BACKUP SETTINGS
# ============================================================
# Local backup directory (will be created if it doesn't exist)
BACKUP_DIR="/Users/josegomez/Documents/Code/SaaS/Copilot/backups/postgres"

# Backup file naming pattern
BACKUP_PREFIX="copilot_db_backup"

# Compression level (0-9, where 9 is maximum compression)
COMPRESSION_LEVEL=9

# Retention policy (in days)
RETENTION_DAYS=30

# Maximum number of backups to keep locally
MAX_LOCAL_BACKUPS=14

# ============================================================
# HETZNER STORAGE BOX CONFIGURATION
# ============================================================
# Enable/disable Hetzner Storage Box upload
HETZNER_ENABLED=true

# Hetzner Storage Box credentials
# Format: username@username.your-storagebox.de
HETZNER_USER=""
HETZNER_HOST=""
HETZNER_PORT=23

# Remote backup directory on Storage Box
HETZNER_REMOTE_DIR="/backups/postgres"

# SSH key path for Hetzner authentication
HETZNER_SSH_KEY="/Users/josegomez/.ssh/id_rsa_hetzner_backup"

# Number of backups to keep on Hetzner (longer retention)
HETZNER_RETENTION_DAYS=90

# ============================================================
# LOGGING CONFIGURATION
# ============================================================
# Log directory
LOG_DIR="/Users/josegomez/Documents/Code/SaaS/Copilot/scripts/backup/logs"

# Log file name pattern
LOG_FILE="${LOG_DIR}/backup_$(date +%Y%m).log"

# Maximum log file size in MB (will rotate when exceeded)
MAX_LOG_SIZE=50

# Number of old log files to keep
LOG_RETENTION=6

# ============================================================
# NOTIFICATION SETTINGS
# ============================================================
# Enable/disable notifications
NOTIFICATIONS_ENABLED=true

# Notification method: email, webhook, or both
NOTIFICATION_METHOD="email"

# Email notifications (using sendmail or mail command)
NOTIFY_EMAIL=""
EMAIL_FROM="backup@yourdomain.com"
EMAIL_SUBJECT_SUCCESS="[SUCCESS] PostgreSQL Backup Completed"
EMAIL_SUBJECT_FAILURE="[FAILURE] PostgreSQL Backup Failed"

# Webhook notifications (POST request with JSON payload)
WEBHOOK_URL=""
WEBHOOK_ENABLED=false

# Slack webhook (if using Slack)
SLACK_WEBHOOK_URL=""
SLACK_ENABLED=false

# ============================================================
# ADVANCED SETTINGS
# ============================================================
# pg_dump additional options
PGDUMP_OPTIONS="--verbose --no-owner --no-acl"

# Enable/disable schema-only backup alongside full backup
SCHEMA_ONLY_BACKUP=true

# Enable/disable data-only backup
DATA_ONLY_BACKUP=false

# Backup timeout in seconds (0 for no timeout)
BACKUP_TIMEOUT=3600

# Enable parallel backup (requires PostgreSQL >= 9.3)
PARALLEL_JOBS=2

# Verify backup after creation
VERIFY_BACKUP=true

# Encryption settings (optional)
ENCRYPTION_ENABLED=false
ENCRYPTION_KEY_FILE="/Users/josegomez/.ssh/backup_encryption.key"

# ============================================================
# HEALTH CHECK SETTINGS
# ============================================================
# Healthcheck endpoint to ping after successful backup
HEALTHCHECK_URL=""
HEALTHCHECK_ENABLED=false

# ============================================================
# MAINTENANCE SETTINGS
# ============================================================
# Run VACUUM ANALYZE before backup
RUN_VACUUM=false

# Run pg_dump with custom format (allows parallel restore)
USE_CUSTOM_FORMAT=true
