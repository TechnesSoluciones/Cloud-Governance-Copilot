# ============================================================
# Cloud Governance Copilot - Production Environment Variables
# ============================================================
# CRITICAL: This file contains production configurations
# 1. Copy to .env.production and fill with actual values
# 2. NEVER commit .env.production to version control
# 3. Use secrets management in production (Vault, AWS Secrets Manager)
# 4. Rotate credentials regularly (every 90 days minimum)
# 5. Audit all environment variable access
# ============================================================

# ============================================================
# ENVIRONMENT & DEPLOYMENT
# ============================================================
NODE_ENV=production
APP_ENV=production
VERSION=1.0.0
DEPLOYMENT_ENV=hetzner
DOCKER_REGISTRY=registry.hetzner.cloud

# ============================================================
# DATABASE - PostgreSQL 15 (Production)
# ============================================================
# IMPORTANT: Use strong passwords (min 32 chars with special chars)
# Example: openssl rand -base64 32

POSTGRES_USER=copilot_prod
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_MIN_32_CHARS
POSTGRES_DB=copilot_main
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Connection string with SSL enabled (Required for production)
# Format: postgresql://user:password@host:port/database?sslmode=require
DATABASE_URL=postgresql://copilot_prod:CHANGE_ME@postgres:5432/copilot_main?sslmode=require&pool_timeout=30&connection_limit=20

# Connection pooling
DB_POOL_MIN=5
DB_POOL_MAX=20
DB_IDLE_TIMEOUT=10000

# ============================================================
# REDIS - Cache & Sessions (Production)
# ============================================================
# Password must be min 32 characters for production
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD_MIN_32_CHARS
REDIS_URL=redis://:CHANGE_ME@redis:6379/0
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_TLS=false

# Cache configuration
CACHE_TTL=3600
CACHE_MAX_SIZE=1000

# ============================================================
# AUTHENTICATION & SECURITY
# ============================================================
# Generate secrets with: openssl rand -base64 32

# JWT Configuration
JWT_SECRET=CHANGE_ME_JWT_SECRET_MIN_32_CHARS_RANDOM
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=CHANGE_ME_JWT_REFRESH_SECRET_MIN_32_CHARS
JWT_REFRESH_EXPIRES_IN=30d

# NextAuth Configuration (for Next.js authentication)
NEXTAUTH_SECRET=CHANGE_ME_NEXTAUTH_SECRET_MIN_32_CHARS_RANDOM
NEXTAUTH_URL=https://copilot.yourdomain.com

# Session encryption
SESSION_SECRET=CHANGE_ME_SESSION_SECRET_MIN_32_CHARS

# Data encryption (Must be exactly 32 bytes/256 bits for AES-256)
# Generate with: openssl rand -hex 16
ENCRYPTION_KEY=CHANGE_ME_ENCRYPTION_KEY_EXACTLY_32_CHARS

# ============================================================
# DOMAINS & URLS (Production)
# ============================================================
DOMAIN=yourdomain.com
API_DOMAIN=api.yourdomain.com
API_URL=https://api.yourdomain.com
FRONTEND_URL=https://copilot.yourdomain.com
NEXT_PUBLIC_API_URL=https://api.yourdomain.com

# Subdomain configuration for modules
COPILOT_SUBDOMAIN=copilot
API_SUBDOMAIN=api
ONECLOUD_SUBDOMAIN=onecloud
SPEND_SUBDOMAIN=spend
SECURITY_SUBDOMAIN=security
ASSET_SUBDOMAIN=asset
INCIDENT_SUBDOMAIN=incident
ADVISOR_SUBDOMAIN=advisor

# ============================================================
# API GATEWAY CONFIGURATION
# ============================================================
API_PORT=4000
API_HOST=0.0.0.0

# CORS - Restrict to your domains in production
CORS_ORIGIN=https://copilot.yourdomain.com,https://*.yourdomain.com,https://yourdomain.com

# Request timeout (milliseconds)
REQUEST_TIMEOUT=30000

# Rate Limiting (strict for production)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100   # per window per IP
ENABLE_RATE_LIMITING=true

# ============================================================
# SSL/TLS CONFIGURATION (Let's Encrypt)
# ============================================================
LETSENCRYPT_EMAIL=admin@yourdomain.com
LETSENCRYPT_STAGING=false
SSL_ENABLED=true
SSL_CERT_PATH=/etc/nginx/ssl/cert.pem
SSL_KEY_PATH=/etc/nginx/ssl/key.pem
SSL_CHAIN_PATH=/etc/nginx/ssl/chain.pem

# ============================================================
# CLOUD PROVIDER APIs - AWS
# ============================================================
# AWS Credentials (IAM user with least privilege)
AWS_ACCESS_KEY_ID=CHANGE_ME_AWS_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=CHANGE_ME_AWS_SECRET_KEY
AWS_REGION=us-east-1
AWS_SESSION_TOKEN=              # Optional for temporary credentials

# AWS S3 for backups (if using AWS instead of Hetzner)
AWS_S3_BUCKET=copilot-backups-prod
AWS_S3_REGION=us-east-1

# ============================================================
# CLOUD PROVIDER APIs - Azure
# ============================================================
AZURE_TENANT_ID=CHANGE_ME_AZURE_TENANT_ID
AZURE_CLIENT_ID=CHANGE_ME_AZURE_CLIENT_ID
AZURE_CLIENT_SECRET=CHANGE_ME_AZURE_CLIENT_SECRET
AZURE_SUBSCRIPTION_ID=CHANGE_ME_AZURE_SUBSCRIPTION_ID

# ============================================================
# CLOUD PROVIDER APIs - Google Cloud
# ============================================================
GCP_PROJECT_ID=CHANGE_ME_GCP_PROJECT_ID
GOOGLE_APPLICATION_CREDENTIALS=/app/secrets/gcp-service-account.json

# ============================================================
# HETZNER OBJECT STORAGE (Recommended for Hetzner deployments)
# ============================================================
HETZNER_OBJECT_STORAGE_ACCESS_KEY=CHANGE_ME_ACCESS_KEY
HETZNER_OBJECT_STORAGE_SECRET_KEY=CHANGE_ME_SECRET_KEY
HETZNER_OBJECT_STORAGE_ENDPOINT=https://fsn1.your-objectstorage.com
HETZNER_BACKUP_BUCKET=copilot-backups-prod
HETZNER_BACKUP_REGION=fsn1

# ============================================================
# EXTERNAL SERVICES - AI
# ============================================================

# OpenAI (AI Insights)
OPENAI_API_KEY=sk-CHANGE_ME_OPENAI_API_KEY
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=2000
OPENAI_TIMEOUT=30000
OPENAI_TEMPERATURE=0.7

# ============================================================
# EXTERNAL SERVICES - BILLING
# ============================================================

# Stripe (Billing & Payments)
STRIPE_SECRET_KEY=sk_live_CHANGE_ME_STRIPE_SECRET_KEY
STRIPE_PUBLISHABLE_KEY=pk_live_CHANGE_ME_STRIPE_PUBLISHABLE_KEY
STRIPE_WEBHOOK_SECRET=whsec_CHANGE_ME_WEBHOOK_SECRET

# Stripe endpoints
STRIPE_API_VERSION=2023-10-16

# ============================================================
# EXTERNAL SERVICES - EMAIL
# ============================================================

# SendGrid (Recommended for production)
SENDGRID_API_KEY=SG.CHANGE_ME_SENDGRID_API_KEY
EMAIL_FROM=noreply@yourdomain.com
EMAIL_FROM_NAME=Cloud Governance Copilot

# Alternative: SMTP Configuration
SMTP_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=CHANGE_ME_SMTP_USER
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
SMTP_SECURE=true

# ============================================================
# EXTERNAL SERVICES - NOTIFICATIONS
# ============================================================

# Slack Integration
SLACK_ENABLED=true
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/CHANGE_ME
SLACK_BOT_TOKEN=xoxb-CHANGE_ME_SLACK_BOT_TOKEN
SLACK_CHANNEL_ALERTS=#alerts-production
SLACK_CHANNEL_ERRORS=#errors-production

# ============================================================
# MONITORING & OBSERVABILITY
# ============================================================

# Sentry (Error Tracking & Performance Monitoring)
SENTRY_ENABLED=true
SENTRY_DSN=https://CHANGE_ME@sentry.io/PROJECT_ID
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% sampling in production
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_RELEASE=1.0.0

# Logging Configuration
LOG_LEVEL=info          # error | warn | info | debug (use 'info' in production)
LOG_FORMAT=json         # json | text (json recommended for parsing)
LOG_TO_FILE=false       # Use external log aggregation instead

# Request logging
LOG_REQUESTS=true
LOG_RESPONSE_BODIES=false  # Don't log sensitive data

# ============================================================
# MONITORING - Prometheus
# ============================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_RETENTION=30d
PROMETHEUS_SCRAPE_INTERVAL=15s
PROMETHEUS_PORT=9090

# ============================================================
# MONITORING - Grafana
# ============================================================
GRAFANA_ENABLED=true
GRAFANA_ADMIN_USER=admin
GRAFANA_PASSWORD=CHANGE_ME_GRAFANA_ADMIN_PASSWORD
GRAFANA_PORT=3001

# ============================================================
# BACKUPS & DISASTER RECOVERY
# ============================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"       # Daily at 2 AM UTC
BACKUP_RETENTION_DAYS=30           # Keep backups for 30 days
BACKUP_ENCRYPTION_KEY=CHANGE_ME_BACKUP_ENCRYPTION_KEY
BACKUP_COMPRESSION=gzip

# Backup Destination (choose one)
BACKUP_STORAGE=hetzner             # hetzner | aws | local

# Restore Configuration
RESTORE_VERIFY=true                # Verify backup integrity
RESTORE_PRE_CHECK=true             # Run health checks before restore

# ============================================================
# FEATURE FLAGS (Production)
# ============================================================
ENABLE_AI_INSIGHTS=true
ENABLE_MARKETPLACE=true
ENABLE_WHITE_LABEL=true
ENABLE_SSO=true
ENABLE_MONITORING=true
ENABLE_RATE_LIMITING=true
ENABLE_API_KEY_AUTH=true
ENABLE_DEBUG=false

# ============================================================
# SECURITY HEADERS & POLICIES
# ============================================================
HELMET_ENABLED=true
HSTS_MAX_AGE=31536000              # 1 year
CSP_ENABLED=true
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff

# ============================================================
# PERFORMANCE & SCALING
# ============================================================

# Node.js Performance
NODE_OPTIONS="--max-old-space-size=2048"
UV_THREADPOOL_SIZE=128

# Database connection pooling
DB_CONNECTION_TIMEOUT=30000
DB_IDLE_TIMEOUT=10000

# Redis timeout
REDIS_TIMEOUT=30000

# ============================================================
# SAAS MODULE CONFIGURATION
# ============================================================
# Internal Docker Network URLs (for inter-service communication)

ONECLOUD_API_URL=http://onecloud-dashboard:3001
ONECLOUD_API_KEY=CHANGE_ME_ONECLOUD_API_KEY

SPEND_API_URL=http://spend-navigator:3002
SPEND_API_KEY=CHANGE_ME_SPEND_API_KEY

SECURITY_API_URL=http://security-misconfig:3003
SECURITY_API_KEY=CHANGE_ME_SECURITY_API_KEY

ASSET_API_URL=http://asset-360:3004
ASSET_API_KEY=CHANGE_ME_ASSET_API_KEY

INCIDENT_API_URL=http://incident-iq:3005
INCIDENT_API_KEY=CHANGE_ME_INCIDENT_API_KEY

ADVISOR_API_URL=http://advisor-report:3006
ADVISOR_API_KEY=CHANGE_ME_ADVISOR_API_KEY

# ============================================================
# COMPLIANCE & AUDIT
# ============================================================
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=365
GDPR_ENABLED=true
DATA_RESIDENCY=eu-west-1

# PII Data Protection
PII_ENCRYPTION_ENABLED=true
PII_MASKING_ENABLED=true

# ============================================================
# MAINTENANCE MODE
# ============================================================
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="We are performing scheduled maintenance. We'll be back soon!"
MAINTENANCE_SKIP_IPS=10.0.0.0/8

# ============================================================
# HETZNER-SPECIFIC CONFIGURATION
# ============================================================

# Server hostname/IP
HETZNER_SERVER_IP=CHANGE_ME_YOUR_HETZNER_IP
HETZNER_SERVER_HOSTNAME=copilot.yourdomain.com

# Firewall rules
HETZNER_FIREWALL_ENABLED=true

# Backups location
HETZNER_BACKUP_LOCATION=/data/copilot/backups

# Object Storage (S3-compatible)
HETZNER_S3_ENDPOINT=https://fsn1.your-objectstorage.com
HETZNER_S3_BUCKET=copilot-backups

# ============================================================
# DOCKER BUILD CONFIGURATION
# ============================================================

# Build arguments
BUILDKIT_INLINE_CACHE=1
DOCKER_BUILDKIT=1

# Image versions
POSTGRES_VERSION=15-alpine
REDIS_VERSION=7-alpine
NGINX_VERSION=1.26-alpine
NODE_VERSION=20-alpine

# ============================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ============================================================
# 1. Replace ALL "CHANGE_ME" values with secure credentials
# 2. Generate strong random passwords: openssl rand -base64 32
# 3. Generate encryption keys: openssl rand -hex 16 (for AES-256)
# 4. Use secrets management service (Vault, AWS Secrets Manager, Hetzner Secrets)
# 5. Enable SSL/TLS certificates (Let's Encrypt recommended)
# 6. Configure firewall rules to restrict access
# 7. Enable monitoring and alerting (Sentry, Prometheus, Grafana)
# 8. Set up log aggregation (ELK, CloudWatch, Datadog, Loki)
# 9. Configure automated backups with retention policy
# 10. Implement disaster recovery plan and test regularly
# 11. Enable audit logging for compliance
# 12. Regular security audits and penetration testing
# 13. Keep dependencies updated (npm audit, Trivy scans)
# 14. Implement rate limiting and DDoS protection
# 15. Use VPN/bastion host for admin access
# 16. Enable MFA for all user accounts
# 17. Implement proper CORS policies
# 18. Configure health checks for all services
# 19. Set up alarms for threshold breaches
# 20. Document runbooks for common incidents
# ============================================================
